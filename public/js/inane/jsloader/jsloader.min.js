(function(factory){var root=(typeof self=='object'&&self.self==self&&self)||(typeof global=='object'&&global.global==global&&global);if(typeof root.JSLoader!=='undefined'){window.console.log('JSLoader already loaded!');return;}
var JSLoader={};_.extend(JSLoader,Backbone.Events);root.JSLoader=factory(root,JSLoader,root.Backbone,(root.jQuery||root.Zepto||root.ender||root.$));}(function(root,JSLoader,Backbone,$){JSLoader.VERSION='0.11.1';JSLoader.verbose=document.currentScript.getAttribute('data-verbose')==1?true:false;JSLoader.moduleList={};JSLoader.noCache=false;JSLoader.manualTrigger=document.currentScript.getAttribute('data-manual')==1?true:false;JSLoader.autospinner=true;var processQueue=[];var scriptCollection=[];var transTime=2000;var history=[];var baseURL=document.currentScript.getAttribute('data-basepath')||'';$.holdReady(true);JSLoader.setBaseUrl=function(url){baseURL=url;return JSLoader;};JSLoader.getBaseUrl=function(){return baseURL;};function without(array,values){if(!Array.isArray(values))values=[values];return array.filter(function(element){return values.indexOf(element)<0;});}
var each=Array.prototype.forEach;JSLoader.enableVerbosity=function(enabled){if(enabled===false)
JSLoader.verbose=false;else
JSLoader.verbose=true;return JSLoader;};function logger(msg,show){if((JSLoader.verbose===true)||(show===true)){window.console.debug('JSLoader: '+msg);}
return JSLoader;}
JSLoader.about=function(){logger(`
Author: Philip Michael Raab<peep@inane.co.za>
Version: ${JSLoader.VERSION}
Script verbosity attribute: 1`);};this._ready=[];JSLoader.ready=function(listener){if(typeof JSLoader._ready=='undefined'){JSLoader._ready=[];}
JSLoader._ready.push(listener);};let removeReady=function(listener){if(JSLoader._ready instanceof Array){var listeners=JSLoader._ready;for(var i=0,len=listeners.length;i<len;i++){if(listeners[i]===listener){listeners.splice(i,1);break;}}}};let runReady=function(){logger('running => ready');if(JSLoader._ready instanceof Array){var listeners=JSLoader._ready;var listener;while(listener=listeners.shift()){listener.call(this);removeReady(listener);}}
logger('finished');JSLoader.trigger('finished');};JSLoader.spinner=false;JSLoader.setAutospinner=function(enabled){if(enabled===false){JSLoader.autospinner=false;}else{JSLoader.autospinner=true;}
return JSLoader;};JSLoader.spinnerStart=function(){if(JSLoader.spinner===false){JSLoader.spinner=document.createElement('div');JSLoader.spinner.classList.add('jsl-fading-circle');JSLoader.spinner.innerHTML=`
<div class="jsl-circle1 jsl-circle"></div>
<div class="jsl-circle2 jsl-circle"></div>
<div class="jsl-circle3 jsl-circle"></div>
<div class="jsl-circle4 jsl-circle"></div>
<div class="jsl-circle5 jsl-circle"></div>
<div class="jsl-circle6 jsl-circle"></div>
<div class="jsl-circle7 jsl-circle"></div>
<div class="jsl-circle8 jsl-circle"></div>
<div class="jsl-circle9 jsl-circle"></div>
<div class="jsl-circle10 jsl-circle"></div>
<div class="jsl-circle11 jsl-circle"></div>
<div class="jsl-circle12 jsl-circle"></div>`;}
JSLoader.spinner.style.width=window.innerWidth+'px';JSLoader.spinner.style.height=window.innerHeight+'px';document.body.appendChild(JSLoader.spinner);JSLoader.spinner.style.opacity=1;logger('spinner => start');return JSLoader;};JSLoader.spinnerStop=function(){if(JSLoader.spinner!==false){JSLoader.spinner.style.opacity=0;setTimeout(function(){JSLoader.spinner.remove();logger('spinner => stop');},transTime);}
return JSLoader;};JSLoader.getHistory=function(){return history;};JSLoader.hasHistory=function(script){return history.indexOf(script)>=0?true:false;};let addHistory=function(script){JSLoader.hasHistory(script)||history.push(script);return JSLoader;};JSLoader.checkDependants=_.once(function(){var keys=_(JSLoader.moduleList).allKeys();keys.forEach(function(module){var requs=JSLoader.moduleList[module].require||[];requs.forEach(function(mod){var deps=JSLoader.moduleList[mod].dependents||[];deps.push(module);deps.sort();JSLoader.moduleList[mod].dependents=deps;});});});JSLoader.addScripts=function(scripts,priority){logger('DEPRECATED => addScripts',true);return addToCollection(scripts,priority);};function addToCollection(scripts,priority){if(scripts.length>0){if(typeof priority==='undefined')priority=10;if(!Array.isArray(scriptCollection[priority]))scriptCollection[priority]=[];scriptCollection[priority]=scriptCollection[priority].concat(scripts);JSLoader.trigger('add',scripts,priority);logger('added => '+scripts.length);}
return JSLoader;}
function parseModuleName(moduleName){logger('parsing => '+moduleName+': for requierments');let moduleNameArray=moduleName.split('.');moduleNameArray.pop();JSLoader.moduleList[moduleName]['require']=JSLoader.moduleList[moduleName].require||[];each.call(moduleNameArray,function(item){JSLoader.moduleList[moduleName].require=JSLoader.moduleList[moduleName].require.concat(item);});}
JSLoader.loadModules=function(modules,priority){modules=modules||[];if(modules.length>0){var scripts=[];each.call(modules,function(module){if(!_(JSLoader.moduleList).has(module)){JSLoader.trigger('ignore',{module:module,error:'Not found in moduleList',event:'ignore'});return;}
if(module.split('.').length>0)parseModuleName(module);if(JSLoader.moduleList[module].loaded!==true){if(Array.isArray(JSLoader.moduleList[module].require)){logger('require => '+JSLoader.moduleList[module].require.join(', '));JSLoader.loadModules(JSLoader.moduleList[module].require,priority);}
let sFiles=[JSLoader.moduleList[module].style,JSLoader.moduleList[module].script];scripts=scripts.concat(without(sFiles,undefined));JSLoader.moduleList[module].loaded=true;}});addToCollection(scripts,priority);}
return JSLoader;};JSLoader.fail=function(_callback){JSLoader.trigger('error',_callback);return JSLoader;};function attachScript(src,isModule,async,defer){const script=document.createElement('script');script.url=src;if(isModule)script.type='module';else script.type='application/javascript';if(async)script.setAttribute('async','');if(defer)script.setAttribute('defer','');document.head.appendChild(script);return new Promise((success,error)=>{script.onload=success;script.onerror=error;script.src=src;});}
function attachStyle(href){const style=document.createElement('link');style.url=href;style.media='screen';style.rel='stylesheet';style.type='text/css';document.head.appendChild(style);return new Promise((success,error)=>{style.onload=success;style.onerror=error;style.href=href;});}
function attachHandler(file){const type=file.split('.').pop();file+=JSLoader.noCache?'?ts='+Date.now():'';if(type==='js')return attachScript(file);else if(type==='css')return attachStyle(file);return false;}
function createQueue(){logger('loading => queue');JSLoader.trigger('queueing');let merged=processQueue;let collection=scriptCollection;scriptCollection=[];each.call(collection,function(scripts){if(typeof scripts!=='undefined'){merged=merged.concat(scripts);}});processQueue=[...new Set(merged)];if(processQueue.length>0){logger('queued => '+processQueue.length);JSLoader.trigger('queued',processQueue.length);return true;}
runReady();if(JSLoader.autospinner)JSLoader.spinnerStop();return false;}
function process(scripts){if(scripts.length>0){$.holdReady(true);let aScript=scripts.shift();aScript=baseURL.concat(aScript);if(JSLoader.hasHistory(aScript)){logger('duplicate => '+aScript);JSLoader.trigger('skipped',aScript);process(scripts);$.holdReady(false);}else{attachHandler(aScript).then(event=>{const script=event.target.url.split('?').shift();addHistory(script);logger('success => '+script);JSLoader.trigger('loaded',script);}).catch(event=>{const script=event.target.url.split('?').shift();logger('Failed => '+script+' => ERROR',true);JSLoader.trigger('error',{script:script,error:event});}).finally(()=>{process(scripts);$.holdReady(false);});}}else{if(createQueue())process(processQueue);$.holdReady(false);logger('loading => done');JSLoader.trigger('done');}}
JSLoader.start=function(){logger('loading => start');JSLoader.trigger('start');JSLoader.checkDependants();if(createQueue())process(processQueue);$.holdReady(false);return JSLoader;};root.document.addEventListener('readystatechange',function(evt){switch(evt.target.readyState){case'loading':break;case'interactive':if(JSLoader.manualTrigger==false)JSLoader.start();break;case'complete':logger('root.document.readyState == \'complete\'');break;}},false);JSLoader.about();return JSLoader;}));